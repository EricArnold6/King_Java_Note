# 整体项目总结思路

- 主要参考自：
  - https://www.bilibili.com/video/BV1np4y1C7Yf?p=101
  - https://www.yuque.com/zhangshuaiyin/guli-mall/wrbzgy
- 整体架构：
  - ![image-20220227125540374](1_%E9%A1%B9%E7%9B%AE%E6%80%9D%E8%B7%AF.assets/image-20220227125540374.png)
- 微服务划分：
  - ![image-20220227125637733](1_%E9%A1%B9%E7%9B%AE%E6%80%9D%E8%B7%AF.assets/image-20220227125637733.png)
- 前置知识：
  - 后端：Java、MySQL、SSM、SpringBoot
  - 中间件：Redis
  - 前端：HTML、CSS、Java Script、Vue
  - 服务部署：Docker

# 1. 分布式基础

- 开发环境配置：
  - docker
  - mysql
  - redis
- 项目创建：
  - 微服务划分
  - 多模块开发
  - 数据库初始化
- 快速开发、逆向工程：
  - 后台管理系统：https://gitee.com/renrenio/renren-fas
  - 后台管理前端：https://gitee.com/renrenio/renren-fast-vue
  - 代码生成器：https://gitee.com/renrenio/renren-generator
- SpringCloud分布式环境配置：
  - 整体分布式：
    - 注册中心：SpringCloud Alibaba Nacos
    - 配置中心：SpringCloud Alibaba Nacos
    - 负载均衡：SpringCloud Ribbon
    - 声明式HTTP客户端：SpringCloud Feign 调用远程服务
    - 服务容错：SpringCloud Alibaba Sentinel 限流、降级、熔断
    - API网关：SpringCloud Gateway webflux 编程模式
    - 调用链路监控：SpringCloud Sleuth
    - 分布式事务：SpringCloud Alibaba Seata 原Fescar
  - Docker安装Nacos
  - Spring Boot中引入
    - SpringCloud Alibaba Feign
    - SpringCloud Alibaba Nacos
    - SpringCloud Gateway
- 正式开发：
  - 人人开源作为后台管理系统的前后端，逆向生成代码
    - MVC
    - POJO、DAO、Service、Controller、Vue
  - 开发遇到的问题？
    - 明确业务流程！思考各种不足，不断测试
    - 确保数据库修改数据的一致性
    - 需要考虑异常、容错机制
    - 前后端数据交互的冗余字段问题？VO？
    - 远程服务调用的数据传输问题？TO？
- SpringCloud Gateway：
  - Vue前端如何发送请求给后端
  - 路由转发如何配置
  - Gateway跨域如何配置
- 跨域？
  - 什么是跨域？
    - 浏览器为了堆Java Script施加安全限制，设置了同源策略，使浏览器不能执行其他网站的脚本
  - 什么是同源策略？
    - 协议、域名、端口号都要严格相同
    - 其中有一个不同都会产生跨域
  - 跨域流程？
    - 对于非简单请求(PUT DELETE)等，需要先发送预检请求
    - ![image-20220227131702568](1_%E9%A1%B9%E7%9B%AE%E6%80%9D%E8%B7%AF.assets/image-20220227131702568.png)
  - 如何解决跨域问题？
    - 法一：使用nginx部署为同一域
      - ![image-20220227131831761](1_%E9%A1%B9%E7%9B%AE%E6%80%9D%E8%B7%AF.assets/image-20220227131831761.png)
    - 法二：配置档次请求允许跨域
      - 添加响应头
        - Access-Control-Allow-Origin:支持哪些来源的请求跨域
        - Access-Control-Allow-Methods:支持哪些方法跨域
        - Access-Control-Allow-Credentials:跨域请求默认不包含cookie，设置为true可以包含 cookie
        - Access-Control-Expose-Headers:跨域请求暴露的字段
          - CORS请求时，XMLHttpRequest对象的getResponseHeader()方法只能拿到6个基本字段: Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma。如 果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。
        - Access-Control-Max-Age:表明该响应的有效时间为多少秒。在有效时间内，浏览器无 须为同一请求再次发起预检请求。请注意，浏览器自身维护了一个最大有效时间，如果 该首部字段的值超过了最大有效时间，将不会生效。
- 数据校验？
  - 前端输入校验？
  - 后段接收数据校验？JSR303
- 统一返回前端JSON数据？
  - Renren-fast中的R类！全局统一返回
- 统一异常处理？
  - 通常采用ControllerAdvice的方式进行统一处理，简化代码
    - 编写异常处理类，使用@ControllerAdvice。
    - 使用@ExceptionHandler标注方法可以处理的异常。
- 文件如何存储？
  - 普通上传文件在分布式下存在的问题？
  - 文件存储？是自建服务器？云存储？
  - 使用阿里云对象存储！
- 如何使用阿里云对象存储？
  - 服务端签名后直传数据
  - ![image-20220227132148218](1_%E9%A1%B9%E7%9B%AE%E6%80%9D%E8%B7%AF.assets/image-20220227132148218.png)
- 对象划分？
  - PO：persistant object
    - PO 就是对应数据库中某个表中的一条记录，多个记录可以用 PO 的集合。 PO 中应该不包 含任何对数据库的操作。
  - DO：Domain Object
    - 就是从现实世界中抽象出来的有形或无形的业务实体。
  - TO：Transfer Object
    - 不同的应用程序之间传输的对象
  - DTO：Data Transfer Object
    - 这个概念来源于 J2EE 的设计模式，原来的目的是为了 EJB 的分布式应用提供粗粒度的 数据实体，以减少分布式调用的次数，从而提高分布式调用的性能和降低网络负载，但在这 里，泛指用于展示层与服务层之间的数据传输对象。
  - VO： Value Object
    - 通常用于业务层之间的数据传递，和 PO 一样也是仅仅包含数据而已。但应是抽象出 的业务对象 , 可以和表对应 , 也可以不 ,这根据业务的需要 。用 new 关键字创建，由 GC 回收的。
    - 也可以叫View object：视图对象;
      - 接受页面传递来的数据，封装对象
      - 将业务处理完成的对象，封装成页面要用的数据
  - BO：Business Object
    - 从业务模型的角度看 , 见 UML 元件领域模型中的领域对象。封装业务逻辑的 java 对 象 , 通过调用 DAO 方法 , 结合 PO,VO进行业务操作。 business object: 业务对象 主要作 用是把业务逻辑封装为一个对象。这个对象可以包括一个或多个其它的对象。 比如一个简 历，有教育经历、工作经历、社会关系等等。 我们可以把教育经历对应一个 PO ，工作经历对应一个 PO，社会关系对应一个 PO 。 建立一个对应简历的 BO 对象处理简历，每 个 BO 包含这些 PO 。 这样处理业务逻辑时，我们就可以针对 BO 去处理。
  - POJO：Plain Ordinary Java Object
    - 传统意义的 java 对象。就是说在一些 Object/Relation Mapping 工具中，能够做到维护 数据库表记录的 persisent object完全是一个符合 Java Bean 规范的纯 Java 对象，没有增 加别的属性和方法。我的理解就是最基本的 java Bean ，只有属性字段及 setter 和 getter 方法!。
    - POJO 是 DO/DTO/BO/VO 的统称。
  - DAO：Data Access Object
    - 是一个 sun 的一个标准 j2ee 设计模式， 这个模式中有个接口就是 DAO ，它负持久 层的操作。为业务层提供接口。此对象用于访问数据库。通常和 PO 结合使用， DAO 中包含了各种数据库的操作方法。通过它的方法 , 结合 PO 对数据库进行相关的操作。夹在业 务逻辑与数据库资源中间。配合 VO, 提供数据库的 CRUD 操作
- 分布式基础总结：
  - 相关概念？
    - 微服务？
    - 注册中心？配置中心？远程调用？
    - 网关？
  - 基础开发？
    - SpringBoot2.0
    - SpringCloud
    - Mybatis-Plus
    - Vue组件化开发
    - 阿里云对象存储
  - 环境？
    - Linux、Docker、Mysql、Redis
    - 逆向工程？人人开源？
  - 开发规范？
    - 前后端数据校验？
    - 全局异常处理？
    - 全局统一返回？
    - 全局跨域处理？
    - 枚举状态？
    - 业务状态码？
    - VO、TO、PO？
    - 逻辑删除